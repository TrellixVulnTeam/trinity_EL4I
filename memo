# Master

docker build -f Dockerfile.master -t trinity_master:latest .

docker run -d --net=host \
      -e MESOS_PORT=5050 \
      -e MESOS_ZK=zk://10.211.172.118:2181/trinity \
      -e MESOS_QUORUM=1 \
      -e MESOS_REGISTRY=in_memory \
      -e MESOS_LOG_DIR=/var/log/mesos \
      -e MESOS_WORK_DIR=/var/tmp/mesos \
      --name trinity_master \
      trinity_master

docker exec -it trinity_master /bin/bash

# Agent

docker build -f Dockerfile.agent -t trinity_agent:latest .

    docker run -d --net=host --privileged \
      -e MESOS_PORT=5051 \
      -e MESOS_MASTER=zk://10.211.172.118:2181/trinity \
      -e MESOS_SWITCH_USER=0 \
      -e MESOS_CONTAINERIZERS=docker,mesos \
      -e MESOS_LOG_DIR=/var/log/mesos \
      -e MESOS_WORK_DIR=/var/tmp/mesos \
      -e MESOS_SYSTEMD_ENABLE_SUPPORT=false \
      -v /var/run/docker.sock:/var/run/docker.sock \
      -v /cgroup:/cgroup \
      -v /sys:/sys \
      -v "$(which docker):/usr/local/bin/docker" \
      --name trinity_agent \
      trinity_agent

docker exec -it trinity_agent /bin/bash

# install conda in Dockerfile
curl https://repo.continuum.io/miniconda/Miniconda-latest-Linux-x86_64.sh -o $HOME/miniconda.sh -s
chmod 0755 $HOME/miniconda.sh
$HOME/miniconda.sh -b -p $HOME/conda
PATH=$HOME/conda/bin:$PATH
conda update conda

# setup Python env
conda env create -f conda_env.yml -q --force
source activate trinity

